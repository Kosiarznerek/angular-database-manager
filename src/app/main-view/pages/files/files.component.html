<!-- Page title and description -->
<h1 class="mat-display-1">{{ (menuItem$ | async).displayName }}</h1>
<p>{{ (menuItem$ | async).description }}</p>
<mat-divider></mat-divider>
<br/>

<!-- Search -->
<div class="row">
  <div class="col-12">
    <mat-form-field class="w-100">
      <input matInput autocomplete="off" placeholder="Wyszukaj pliku" [formControl]="fileNameControl">
    </mat-form-field>
  </div>
</div>

<!-- Files -->
<div class="row files-container" *ngIf="filesData$ | async as filesData; else loadingFilesTemplate">

  <!-- Loading backdrop -->
  <div class="loading-backdrop" *ngIf="showLoadingBackdrop">
    <mat-spinner></mat-spinner>
  </div>

  <!-- No files -->
  <div class="col-12" *ngIf="filesData.values.length===0">
    <app-info-card type="accent" text="Brak plików"></app-info-card>
  </div>

  <!-- Files list -->
  <ng-container *ngFor="let file of filesData.values">
    <div class="col-lg-2 col-md-3 col-6" *ngIf="!file.isDeleted">
      <button class="file-icon-container" mat-button [matMenuTriggerData]="{element: file}"
              [matMenuTriggerFor]="fileContextMenu">
        <mat-icon color="primary">insert_drive_file</mat-icon>
        <span>{{ file.name | truncateText : 20 : ' ...' }}</span>
      </button>
    </div>
  </ng-container>

</div>
<!-- /Files -->

<br/>

<!-- Paginator -->
<div class="row">
  <div class="col-12">
    <app-paginator
      [state]="filesData$ | async"
      (stateChange)="onPaginatorStateChange($event)">
    </app-paginator>
  </div>
</div>

<!-- File context menu -->
<mat-menu #fileContextMenu="matMenu">
  <ng-template matMenuContent let-element="element">
    <button mat-menu-item (click)="onFileRenameButtonClick(element)">
      <mat-icon>edit</mat-icon>
      <span>Zmień nazwę</span>
    </button>
    <button mat-menu-item (click)="onFileDownloadButtonClick(element)">
      <mat-icon>save</mat-icon>
      <span>Pobierz</span>
    </button>
    <button mat-menu-item [disabled]="!element.deletable" (click)="onFileDeleteButtonClick(element)">
      <mat-icon>delete</mat-icon>
      <span>Usuń</span>
    </button>
  </ng-template>
</mat-menu>

<!-- Loading template -->
<ng-template #loadingFilesTemplate>
  <mat-spinner></mat-spinner>
</ng-template>
